<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIGDecoder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #e5e7eb;
        }
        .card {
            background-color: #1f2937;
            border: 1px solid #374151;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .card.selected {
            border-color: #ef4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
            background-color: #2c3a4b;
        }
        .tab {
             transition: all 0.2s ease-in-out;
        }
        .tab.active {
            border-bottom-color: #ef4444;
            color: #ef4444;
        }
        .btn-primary {
            background-color: #ef4444;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #dc2626;
        }
        .btn-secondary {
            background-color: #4b5563;
            transition: background-color 0.2s;
        }
        .btn-secondary:hover {
            background-color: #6b7280;
        }
        .custom-checkbox:checked, .custom-radio:checked {
            background-color: #ef4444;
            border-color: #ef4444;
        }
        .custom-checkbox:checked {
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        }
        .custom-radio:checked {
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3ccircle cx='8' cy='8' r='3'/%3e%3c/svg%3e");
        }
        select {
            background-color: #374151;
            border-color: #4b5563;
        }
        #tabs::-webkit-scrollbar { height: 4px; }
        #tabs::-webkit-scrollbar-track { background: #1f2937; }
        #tabs::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 2px; }
        #tabs::-webkit-scrollbar-thumb:hover { background: #ef4444; }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="relative text-center mb-8">
            <h1 id="main-title" class="text-3xl sm:text-4xl font-bold text-white flex items-center justify-center gap-3">
                <svg class="w-10 h-10 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.624l-.219.872-.219-.872a1.875 1.875 0 00-1.152-1.152l-.872-.219.872-.219a1.875 1.875 0 001.152-1.152l.219-.872.219.872a1.875 1.875 0 001.152 1.152l.872.219-.872.219a1.875 1.875 0 00-1.152 1.152z" />
                </svg>
                BIGDecoder <span class="text-xl text-red-400">v13.1</span>
            </h1>
            <p id="subtitle" class="text-gray-400 mt-2">Profesjonalny Silnik Strategii Sprzeda≈ºowych</p>
            <button id="lang-toggle" class="absolute top-0 right-0 bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg text-sm">
                EN
            </button>
        </header>

        <!-- Input Section -->
        <div id="inputSection" class="space-y-8">
            <div>
                <h2 id="header-demographics" class="text-2xl font-semibold mb-4 border-l-4 border-red-500 pl-3">1. Dane Demograficzne Klienta</h2>
                <div id="demographicsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
            </div>
            <div>
                <h2 id="header-context" class="text-2xl font-semibold mb-4 border-l-4 border-red-500 pl-3">2. Kontekst Sytuacyjny</h2>
                <div id="contextContainer" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4"></div>
            </div>
            <div>
                <h2 id="header-triggers" class="text-2xl font-semibold mb-4 border-l-4 border-red-500 pl-3">3. Triggery z rozmowy</h2>
                <div id="triggersContainer" class="space-y-6"></div>
            </div>
            <div class="text-center pt-8">
                <button id="analyzeButton" class="btn-primary text-white font-bold py-3 px-12 rounded-lg text-lg shadow-lg shadow-red-500/20">
                    Analizuj Klienta
                </button>
            </div>
        </div>

        <!-- Analysis Section -->
        <div id="analysisSection" class="hidden mt-12">
             <div class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
                 <h2 id="results-title" class="text-3xl font-bold text-white text-center sm:text-left">Wyniki Analizy</h2>
                 <button id="resetButton" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg w-full sm:w-auto">Zacznij od nowa</button>
             </div>

            <div class="card rounded-lg p-2">
                <div class="border-b border-gray-700">
                    <nav id="tabs" class="-mb-px flex space-x-2 sm:space-x-6 overflow-x-auto" aria-label="Tabs"></nav>
                </div>
                <div id="tabContent" class="pt-6 pb-2"></div>
            </div>
        </div>
    </div>

    <!-- Deep Dive Modal -->
    <div id="deepDiveModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-gray-800 rounded-lg shadow-xl p-6 max-w-lg w-full border border-gray-700">
            <h3 id="deepDiveTitle" class="text-xl font-bold text-white mb-4">Doprecyzuj Analizƒô</h3>
            <div id="deepDiveContent" class="space-y-3 mb-6"></div>
            <div class="flex justify-end gap-4">
                <button id="closeDeepDiveButton" class="btn-secondary text-white font-bold py-2 px-6 rounded-lg">Anuluj</button>
                <button id="applyDeepDiveButton" class="btn-primary text-white font-bold py-2 px-6 rounded-lg">Zastosuj</button>
            </div>
        </div>
    </div>


    <script>
        let currentLanguage = 'pl';
        let discChart = null; // Global chart instance
        let selectedDeepDive = {}; // To store deep dive choices

        // --- UI TRANSLATIONS DATABASE ---
        const translations = {
            pl: {
                subtitle: "Profesjonalny Silnik Strategii Sprzeda≈ºowych",
                header_demographics: "1. Dane Demograficzne Klienta",
                header_context: "2. Kontekst Sytuacyjny",
                header_triggers: "3. Triggery z rozmowy",
                analyze_button: "Analizuj Klienta",
                results_title: "Wyniki Analizy",
                reset_button: "Zacznij od nowa",
                disc_title: "G≈Ç√≥wny Typ DISC",
                archetype_title: "Wykryty Archetyp",
                confidence_title: "Pewno≈õƒá Analizy",
                model_title: "Sugerowany Model Tesli",
                disc_radar_title: "Profil Osobowo≈õci DISC",
                modal_error_text: "Wybierz przynajmniej jeden trigger lub uzupe≈Çnij dane demograficzne.",
                modal_ok_button: "OK",
                quick_response: "Szybka odpowied≈∫",
                deep_dive_button: "Doprecyzuj Analizƒô ‚ûî",
                deep_dive_title: "Doprecyzuj Analizƒô",
                deep_dive_apply: "Zastosuj",
                deep_dive_cancel: "Anuluj",
                unlocked_playbook_title: "Odblokowane Porady (Analiza G≈Çƒôbinowa)",
                communication_title: "üó£Ô∏è Jƒôzyk i Komunikacja",
                keywords_title: "S≈Çowa-Klucze",
                phrases_title: "Z≈Çote Frazy",
                talking_points_title: "Kluczowe Punkty do Poruszenia",
                fun_drive_title: "Wska≈∫nik Intencji Zakupowej",
                ovn_potential_title: "Potencja≈Ç Jazdy Weekendowej (OVN)",
                tabs: {
                    summary: "üìä Podsumowanie",
                    communication: "üó£Ô∏è Komunikacja",
                    playbook: "üìù Playbook",
                    objections: "üõ°Ô∏è Zbijanie Obiekcji",
                    competition: "üÜö Konkurencja",
                    techniques: "üí° Techniki"
                }
            },
            en: {
                subtitle: "Professional Sales Strategy Engine",
                header_demographics: "1. Customer Demographics",
                header_context: "2. Situational Context",
                header_triggers: "3. Conversation Triggers",
                analyze_button: "Analyze Customer",
                results_title: "Analysis Results",
                reset_button: "Start Over",
                disc_title: "Main DISC Type",
                archetype_title: "Detected Archetype",
                confidence_title: "Analysis Confidence",
                model_title: "Suggested Tesla Model",
                disc_radar_title: "DISC Personality Profile",
                modal_error_text: "Please select at least one trigger or fill in demographic data.",
                modal_ok_button: "OK",
                quick_response: "Quick response",
                deep_dive_button: "Refine Analysis ‚ûî",
                deep_dive_title: "Refine Analysis",
                deep_dive_apply: "Apply",
                deep_dive_cancel: "Cancel",
                unlocked_playbook_title: "Unlocked Insights (Deep Dive Analysis)",
                communication_title: "üó£Ô∏è Language & Communication",
                keywords_title: "Keywords",
                phrases_title: "Golden Phrases",
                talking_points_title: "Key Talking Points",
                fun_drive_title: "Purchase Intent Score",
                ovn_potential_title: "Overnight Test Drive Potential",
                tabs: {
                    summary: "üìä Summary",
                    communication: "üó£Ô∏è Communication",
                    playbook: "üìù Playbook",
                    objections: "üõ°Ô∏è Objection Handling",
                    competition: "üÜö Competition",
                    techniques: "üí° Techniques"
                }
            }
        };

        // --- NEW DATA SOURCES (VALIDATED 31.07.2025) ---

        // Market Intelligence Database
        const market_data = {
          "version": "2.0", "last_updated": "2025-07-31",
          "government_subsidies": {
            "nasz_eauto_program": {
              "remaining_budget": 210000000, 
              "estimated_depletion_date": "2025-10-20",
              "subsidy_amounts": { "individual_new_ev": 18750, "business_lease_new_ev": 30000 }
            }
          },
          "competitor_analysis": {
            "bmw_ix3": { "name": "BMW iX3", "base_price": 297000, "key_advantages": ["Premium brand heritage", "Established dealer network"], "key_disadvantages": ["Lower range", "Slower charging", "Less advanced software"] },
            "audi_q4_etron": { "name": "Audi Q4 e-tron", "base_price": 278700, "key_advantages": ["Luxury interior", "Build quality"], "key_disadvantages": ["Higher maintenance costs", "Complex infotainment"] }
          }
        };

        // Persuasion Techniques Database
        const persuasion_data = {
          "framing": { name: {pl: "Framing (Ramkowanie)", en: "Framing"}, description: {pl: "Podkre≈õlanie utraconych korzy≈õci przy pozostaniu przy aucie spalinowym.", en: "Highlighting the lost benefits of sticking with a combustion engine car."} },
          "social_proof": { name: {pl: "Dow√≥d Spo≈Çeczny", en: "Social Proof"}, description: {pl: "Pokazywanie, ≈ºe inni, podobni ludzie ju≈º dokonali wyboru i sƒÖ zadowoleni.", en: "Showing that other, similar people have already made the choice and are satisfied."} },
          "authority": { name: {pl: "Zasada Autorytetu", en: "Authority Principle"}, description: {pl: "Powo≈Çywanie siƒô na opinie ekspert√≥w, wyniki test√≥w, wizjƒô lidera.", en: "Citing expert opinions, test results, and a leader's vision."} },
          "scarcity_ethical": { name: {pl: "Zasada Niedoboru (Etyczna)", en: "Scarcity Principle (Ethical)"}, description: {pl: "Podkre≈õlanie rzeczywi≈õcie ograniczonej dostƒôpno≈õci lub limitowanego czasu oferty.", en: "Emphasizing genuinely limited availability or a time-limited offer."} },
          "benefits_language": { name: {pl: "Jƒôzyk Korzy≈õci", en: "Benefits Language"}, description: {pl: "M√≥wienie o cechach produktu w kontek≈õcie konkretnych korzy≈õci dla danego klienta.", en: "Talking about product features in the context of specific benefits for the customer."} }
        };
        
        // Objections Database
        const objections_data = {
          "OBJ_PRICE_HIGH": {
            rebuttals: [
              { level: 1, technique: "framing", script: {pl: "Rozumiem, ≈ºe cena poczƒÖtkowa mo≈ºe wydawaƒá siƒô wysoka. Jednak proponujƒô spojrzeƒá na to jako na inwestycjƒô. Dziƒôki oszczƒôdno≈õciom na paliwie rzƒôdu 800 z≈Ç miesiƒôcznie i serwisie, ten samoch√≥d w perspektywie 5 lat mo≈ºe okazaƒá siƒô ta≈Ñszy ni≈º jego spalinowy odpowiednik.", en: "I understand the initial price may seem high. However, I suggest looking at it as an investment. With fuel savings of around 800 PLN per month and service, this car can be cheaper than its combustion counterpart over 5 years."} },
              { level: 2, technique: "scarcity_ethical", script: {pl: "Warto te≈º pamiƒôtaƒá, ≈ºe program dop≈Çat ma ograniczony bud≈ºet, z kt√≥rego zosta≈Ço ju≈º tylko [REMAINING_BUDGET] z≈Ç, i mo≈ºe zako≈Ñczyƒá siƒô wcze≈õniej, oko≈Ço [DEPLETION_DATE]. To realna oszczƒôdno≈õƒá [SUBSIDY_AMOUNT] z≈Ç, kt√≥ra mo≈ºe zniknƒÖƒá.", en: "It's also worth remembering that the subsidy program has a limited budget, with only [REMAINING_BUDGET] PLN left, and it might end sooner, around [DEPLETION_DATE]. This is a real saving of [SUBSIDY_AMOUNT] PLN that could disappear."} }
            ]
          },
          "OBJ_RANGE_WINTER": {
            rebuttals: [
              { level: 1, technique: "authority", script: {pl: "To bardzo czƒôsta obawa. Niezale≈ºne testy pokazujƒÖ, ≈ºe realny zasiƒôg zimƒÖ to wciƒÖ≈º ponad 350 km, a 95% codziennych podr√≥≈ºy Polak√≥w to dystanse poni≈ºej 50 km. Czy Pana codzienne trasy sƒÖ d≈Çu≈ºsze?", en: "That's a very common concern. Independent tests show that the real winter range is still over 350 km, and 95% of daily trips in Poland are under 50 km. Are your daily routes longer?"} },
              { level: 2, technique: "benefits_language", script: {pl: "Dodatkowo, ten model jest wyposa≈ºony w pompƒô ciep≈Ça, kt√≥ra dla Pana oznacza minimalne straty energii zimƒÖ i maksymalny komfort bez kompromis√≥w.", en: "Additionally, this model is equipped with a heat pump, which for you means minimal energy loss in winter and maximum comfort without compromise."} }
            ]
          }
        };

        // DEEP DIVE ANALYSIS DATABASE
        const deep_dive_data = {
            "performance_interest": [
                { id: "dd_perf_1", text: {pl: "Czy przyspieszenie 0-100 km/h to dla Pana kluczowy parametr?", en: "Is 0-100 km/h acceleration a key parameter for you?"}, modifiers: { D: 0.10, I: 0.05 }, playbook_unlock: "acceleration_focus_argument" },
                { id: "dd_perf_2", text: {pl: "Czy planuje Pan je≈∫dziƒá autem na torze wy≈õcigowym?", en: "Do you plan to drive the car on a racetrack?"}, modifiers: { D: 0.15, S: -0.10, I: 0.05 }, playbook_unlock: "track_mode_argument" }
            ],
            "range_anxiety": [
                { id: "dd_range_1", text: {pl: "Czy obawa dotyczy codziennych dojazd√≥w czy d≈Çugich wakacyjnych tras?", en: "Does the concern relate to daily commutes or long holiday trips?"}, modifiers: { S: 0.10, C: 0.05 }, playbook_unlock: "trip_planner_argument" },
                { id: "dd_range_2", text: {pl: "Czy ma Pan mo≈ºliwo≈õƒá ≈Çadowania w domu lub w pracy?", en: "Do you have the ability to charge at home or at work?"}, modifiers: { S: -0.10 }, playbook_unlock: "home_charging_argument" }
            ],
            "price_concern": [
                { id: "dd_price_1", text: {pl: "Czy g≈Ç√≥wnƒÖ barierƒÖ jest miesiƒôczna rata, czy ca≈Çkowity koszt posiadania (TCO)?", en: "Is the main barrier the monthly payment or the total cost of ownership (TCO)?"}, modifiers: { S: 0.10, C: 0.15 }, playbook_unlock: "tco_vs_lease_argument" },
                { id: "dd_price_2", text: {pl: "Czy por√≥wnuje Pan/Pani warto≈õƒá Tesli do innych aut w podobnej cenie?", en: "Are you comparing the value of a Tesla to other cars in a similar price range?"}, modifiers: { D: 0.10, C: 0.10 }, playbook_unlock: "value_comparison_argument" }
            ],
            "no_charging_place": [
                { id: "dd_charge_1", text: {pl: "Czy mieszka Pan/Pani w domu jednorodzinnym czy w bloku/apartamentowcu?", en: "Do you live in a single-family house or an apartment building?"}, modifiers: { S: 0.15 }, playbook_unlock: "house_vs_flat_charging_argument" },
                { id: "dd_charge_2", text: {pl: "Czy obawa dotyczy codziennego ≈Çadowania, czy raczej d≈Çugich wyjazd√≥w?", en: "Is the concern about daily charging or rather long trips?"}, modifiers: { S: 0.10, C: 0.10 }, playbook_unlock: "daily_vs_trip_charging_argument" }
            ],
            "family_practicality": [
                { id: "dd_family_1", text: {pl: "Czy priorytetem jest bezpiecze≈Ñstwo (foteliki) czy przestrze≈Ñ (baga≈º)?", en: "Is the priority safety (child seats) or space (luggage)?"}, modifiers: { S: 0.15, C: 0.05 }, playbook_unlock: "safety_vs_space_argument" },
                { id: "dd_family_2", text: {pl: "Czy auto bƒôdzie u≈ºywane g≈Ç√≥wnie do jazdy po mie≈õcie, czy na d≈Çugie wakacje?", en: "Will the car be used mainly for city driving or for long holidays?"}, modifiers: { S: 0.10, I: 0.05 }, playbook_unlock: "city_vs_holiday_use_argument" },
                { id: "dd_family_3", text: {pl: "Czy kluczowa jest rozrywka dla dzieci (Netflix, gry)?", en: "Is entertainment for children (Netflix, games) a key factor?"}, modifiers: { I: 0.15 }, playbook_unlock: "entertainment_for_kids_argument" }
            ]
        };

        const unlocked_playbook_content = {
            "acceleration_focus_argument": { title: {pl: "Argument: Fokus na przyspieszenie", en: "Argument: Focus on Acceleration"}, content: {pl: "Podkre≈õl, ≈ºe Model 3 Performance osiƒÖga 100 km/h w 3.3 sekundy, co deklasuje wiƒôkszo≈õƒá aut sportowych w tym segmencie cenowym. To nie jest tylko szybkie auto - to supersamoch√≥d w cenie sedana.", en: "Emphasize that the Model 3 Performance reaches 100 km/h in 3.3 seconds, outperforming most sports cars in this price segment. It's not just a fast car - it's a supercar at the price of a sedan."} },
            "track_mode_argument": { title: {pl: "Argument: Tryb Torowy (Track Mode)", en: "Argument: Track Mode"}, content: {pl: "Wspomnij o dedykowanym 'Track Mode V2', kt√≥ry pozwala na pe≈ÇnƒÖ personalizacjƒô balansu mocy, kontroli trakcji i ch≈Çodzenia baterii. To narzƒôdzie stworzone dla entuzjast√≥w, kt√≥rzy chcƒÖ wycisnƒÖƒá z auta 100% na torze.", en: "Mention the dedicated 'Track Mode V2', which allows for full customization of power balance, traction control, and battery cooling. It's a tool created for enthusiasts who want to get 100% out of the car on the track."} },
            "trip_planner_argument": { title: {pl: "Argument: Planer Podr√≥≈ºy", en: "Argument: Trip Planner"}, content: {pl: "Poka≈º klientowi wbudowany w nawigacjƒô planer podr√≥≈ºy. Podkre≈õl, ≈ºe system sam planuje postoje na ≈Çadowanie, uwzglƒôdniajƒÖc Superchargery i czas potrzebny na do≈Çadowanie. To ca≈Çkowicie eliminuje 'range anxiety' na d≈Çugich trasach.", en: "Show the customer the built-in trip planner in the navigation. Emphasize that the system automatically plans charging stops, including Superchargers and the time needed to recharge. This completely eliminates 'range anxiety' on long trips."} },
            "home_charging_argument": { title: {pl: "Argument: Wygoda ≈Åadowania w Domu", en: "Argument: Convenience of Home Charging"}, content: {pl: "Przedstaw ≈Çadowanie w domu jako zmianƒô paradygmatu: 'Ka≈ºdego ranka budzi siƒô Pan z w pe≈Çni na≈Çadowanym autem, gotowym na 400-500 km jazdy. To tak, jakby mieƒá stacjƒô benzynowƒÖ w gara≈ºu, ale znacznie taniej.'", en: "Present home charging as a paradigm shift: 'Every morning you wake up with a fully charged car, ready for 400-500 km of driving. It's like having a gas station in your garage, but much cheaper.'"} },
            "tco_vs_lease_argument": { title: {pl: "Argument: Rata vs TCO", en: "Argument: Monthly Payment vs TCO"}, content: {pl: "Je≈õli klient skupia siƒô na racie, przedstaw atrakcyjne warunki leasingu. Je≈õli na TCO, poka≈º szczeg√≥≈ÇowƒÖ kalkulacjƒô oszczƒôdno≈õci na paliwie i serwisie w perspektywie 5 lat, udowadniajƒÖc, ≈ºe wy≈ºsza cena zakupu zwraca siƒô z nawiƒÖzkƒÖ.", en: "If the customer focuses on the monthly payment, present attractive leasing terms. If on TCO, show a detailed calculation of fuel and service savings over 5 years, proving that the higher purchase price pays for itself and then some."} },
            "value_comparison_argument": { title: {pl: "Argument: Warto≈õƒá vs Cena", en: "Argument: Value vs Price"}, content: {pl: "Zg√≥d≈∫ siƒô, ≈ºe inne auta mogƒÖ byƒá ta≈Ñsze, ale podkre≈õl 'warto≈õƒá' Tesli: najni≈ºsza utrata warto≈õci na rynku, ciƒÖg≈Çe aktualizacje oprogramowania, dostƒôp do sieci Supercharger i najwy≈ºsze bezpiecze≈Ñstwo. To inwestycja, nie tylko wydatek.", en: "Agree that other cars might be cheaper, but emphasize the 'value' of a Tesla: the lowest depreciation on the market, continuous software updates, access to the Supercharger network, and top safety. It's an investment, not just an expense."} },
            "house_vs_flat_charging_argument": { title: {pl: "Argument: ≈Åadowanie Dom vs Blok", en: "Argument: House vs Apartment Charging"}, content: {pl: "Dla domu: podkre≈õl wygodƒô i niski koszt Wall Connector. Dla bloku: przedstaw mapƒô publicznych ≈Çadowarek, w tym szybkich DC w okolicy, i opowiedz o wsp√≥≈Çpracy z firmami instalujƒÖcymi ≈Çadowarki w gara≈ºach podziemnych.", en: "For a house: emphasize the convenience and low cost of a Wall Connector. For an apartment: present a map of public chargers, including fast DC chargers in the area, and talk about partnerships with companies that install chargers in underground garages."} },
            "daily_vs_trip_charging_argument": { title: {pl: "Argument: ≈Åadowanie Codzienne vs Podr√≥≈ºe", en: "Argument: Daily vs Trip Charging"}, content: {pl: "Wyja≈õnij, ≈ºe 95% ≈Çadowa≈Ñ odbywa siƒô w domu, co jest tanie i wygodne. Na d≈Çugie podr√≥≈ºe jest sieƒá Supercharger√≥w, kt√≥ra dziƒôki Planerowi Podr√≥≈ºy jest w pe≈Çni zautomatyzowana i bezproblemowa. 'Tankujesz' auto tam, gdzie ≈õpisz, a nie na stacji.", en: "Explain that 95% of charging happens at home, which is cheap and convenient. For long trips, there's the Supercharger network, which is fully automated and hassle-free thanks to the Trip Planner. You 'fuel' the car where you sleep, not at a station."} },
            "safety_vs_space_argument": { title: {pl: "Argument: Bezpiecze≈Ñstwo vs Przestrze≈Ñ", en: "Argument: Safety vs Space"}, content: {pl: "Je≈õli priorytetem jest bezpiecze≈Ñstwo, skup siƒô na 5 gwiazdkach Euro NCAP i ≈Çatwo≈õci monta≈ºu 3 fotelik√≥w ISOFIX. Je≈õli przestrze≈Ñ - poka≈º ogromny baga≈ºnik przedni (frunk) i tylny oraz p≈ÇaskƒÖ pod≈Çogƒô w drugim rzƒôdzie siedze≈Ñ.", en: "If the priority is safety, focus on the 5-star Euro NCAP rating and the ease of installing 3 ISOFIX child seats. If it's space - show the huge front (frunk) and rear trunks and the flat floor in the second row of seats."} },
            "city_vs_holiday_use_argument": { title: {pl: "Argument: Miasto vs Wakacje", en: "Argument: City vs Holiday"}, content: {pl: "Dla miasta: podkre≈õl zdalne w≈ÇƒÖczanie klimatyzacji/ogrzewania, co jest idealne dla dzieci. Dla wakacji: argumentuj niskim kosztem przejazdu (np. 15 z≈Ç/100km) i Autopilotem, kt√≥ry znacznie zmniejsza zmƒôczenie kierowcy na d≈Çugich trasach.", en: "For the city: highlight remote climate control activation, which is perfect for kids. For holidays: argue the low cost of travel (e.g., 15 PLN/100km) and Autopilot, which significantly reduces driver fatigue on long trips."} },
            "entertainment_for_kids_argument": { title: {pl: "Argument: Rozrywka dla Dzieci", en: "Argument: Entertainment for Kids"}, content: {pl: "Poka≈º wbudowane aplikacje takie jak Netflix, YouTube i gry. Podkre≈õl, ≈ºe d≈Çugie podr√≥≈ºe z dzieƒámi stajƒÖ siƒô przyjemno≈õciƒÖ, a nie walkƒÖ o uwagƒô. To unikalna cecha, kt√≥rej nie oferuje wiƒôkszo≈õƒá konkurencji.", en: "Showcase built-in apps like Netflix, YouTube, and games. Emphasize that long trips with children become a pleasure, not a fight for attention. This is a unique feature that most competitors do not offer."} }
        };

        // Communication Cheatsheet Database
        const communication_data = {
            D: {
                keywords: {pl: ["efektywno≈õƒá", "wynik", "przewaga", "lider", "innowacja", "moc", "kontrola"], en: ["efficiency", "result", "advantage", "leader", "innovation", "power", "control"]},
                phrases: [
                    {pl: "To rozwiƒÖzanie zapewni Panu/Pani przewagƒô konkurencyjnƒÖ i maksymalny zwrot z inwestycji.", en: "This solution will give you a competitive advantage and maximum return on investment."},
                    {pl: "Skupmy siƒô na konkretnych wynikach: ten model gwarantuje najni≈ºszy koszt TCO w swojej klasie.", en: "Let's focus on concrete results: this model guarantees the lowest TCO in its class."}
                ],
                talking_points: [
                    {pl: "Korzy≈õci Podatkowe: Amortyzacja 225 000 z≈Ç i 100% odliczenie VAT.", en: "Tax Benefits: 225,000 PLN depreciation and 100% VAT deduction."},
                    {pl: "Wizerunek Biznesowy: Innowacyjna firma, kt√≥ra dba o przysz≈Ço≈õƒá.", en: "Business Image: An innovative company that cares about the future."},
                    {pl: "ROI: Zwrot z inwestycji w 3-4 lata dziƒôki oszczƒôdno≈õciom.", en: "ROI: Return on investment in 3-4 years thanks to savings."}
                ]
            },
            I: {
                keywords: {pl: ["niesamowite", "rewolucja", "spo≈Çeczno≈õƒá", "razem", "wyjƒÖtkowy", "inspiracja", "przysz≈Ço≈õƒá"], en: ["amazing", "revolution", "community", "together", "unique", "inspiration", "future"]},
                phrases: [
                    {pl: "Proszƒô sobie wyobraziƒá, jakie wra≈ºenie zrobi to na Pana/Pani znajomych i partnerach biznesowych!", en: "Imagine the impression this will make on your friends and business partners!"},
                    {pl: "Do≈ÇƒÖczajƒÖc do nas, staje siƒô Pan/Pani czƒô≈õciƒÖ ekskluzywnej spo≈Çeczno≈õci innowator√≥w.", en: "By joining us, you become part of an exclusive community of innovators."}
                ],
                talking_points: [
                    {pl: "Status Spo≈Çeczny: Posiadanie Tesli to symbol nowoczesno≈õci i sukcesu.", en: "Social Status: Owning a Tesla is a symbol of modernity and success."},
                    {pl: "Spo≈Çeczno≈õƒá: Dostƒôp do ekskluzywnych wydarze≈Ñ i grupy w≈Ça≈õcicieli.", en: "Community: Access to exclusive events and a group of owners."},
                    {pl: "Nowe Technologie: Bƒôdzie Pan/Pani zawsze o krok przed innymi.", en: "New Technologies: You will always be one step ahead of others."}
                ]
            },
            S: {
                keywords: {pl: ["bezpiecze≈Ñstwo", "gwarancja", "stabilno≈õƒá", "wsparcie", "rodzina", "zaufanie", "spok√≥j"], en: ["safety", "guarantee", "stability", "support", "family", "trust", "peace"]},
                phrases: [
                    {pl: "Naszym priorytetem jest zapewnienie Panu/Pani pe≈Çnego bezpiecze≈Ñstwa i spokoju na lata.", en: "Our priority is to provide you with complete safety and peace of mind for years to come."},
                    {pl: "To sprawdzona i niezawodna technologia z 8-letniƒÖ gwarancjƒÖ na bateriƒô, kt√≥rej zaufa≈Çy ju≈º tysiƒÖce rodzin w Polsce.", en: "This is a proven and reliable technology with an 8-year battery warranty, trusted by thousands of families in Poland."}
                ],
                talking_points: [
                    {pl: "Bezpiecze≈Ñstwo Rodziny: 5 gwiazdek w testach Euro NCAP i zaawansowane systemy.", en: "Family Safety: 5 stars in Euro NCAP tests and advanced systems."},
                    {pl: "Niezawodno≈õƒá: 8 lat gwarancji na bateriƒô i napƒôd, minimalna obs≈Çuga.", en: "Reliability: 8-year warranty on battery and drive unit, minimal maintenance."},
                    {pl: "Oszczƒôdno≈õci D≈Çugoterminowe: Stabilne i przewidywalne koszty utrzymania.", en: "Long-Term Savings: Stable and predictable maintenance costs."}
                ]
            },
            C: {
                keywords: {pl: ["dane", "analiza", "dow√≥d", "specyfikacja", "jako≈õƒá", "precyzja", "weryfikacja"], en: ["data", "analysis", "proof", "specification", "quality", "precision", "verification"]},
                phrases: [
                    {pl: "Pozwoli Pan/Pani, ≈ºe przedstawiƒô szczeg√≥≈ÇowƒÖ analizƒô danych i konkretne dowody potwierdzajƒÖce nasze tezy.", en: "Allow me to present a detailed data analysis and concrete evidence supporting our claims."},
                    {pl: "Wszystkie nasze twierdzenia opieramy na weryfikowalnych danych i niezale≈ºnych testach.", en: "All our claims are based on verifiable data and independent tests."}
                ],
                talking_points: [
                    {pl: "Analiza TCO: Poka≈ºƒô Panu dok≈Çadne wyliczenia, kt√≥re udowadniajƒÖ op≈Çacalno≈õƒá.", en: "TCO Analysis: I will show you exact calculations that prove its cost-effectiveness."},
                    {pl: "Dane Techniczne: Porozmawiajmy o specyfikacji baterii, wydajno≈õci i kWh.", en: "Technical Data: Let's talk about battery specifications, efficiency, and kWh."},
                    {pl: "Jako≈õƒá i Precyzja: Om√≥wmy proces produkcyjny i materia≈Çy u≈ºyte w poje≈∫dzie.", en: "Quality and Precision: Let's discuss the manufacturing process and the materials used in the vehicle."}
                ]
            }
        };

        // --- CORE APPLICATION DATABASE v13.0 ---
        const a_database = {
            config: {
                demographic_modifiers: {
                    age: { "18-25": {I:0.15, D:0.10, S:-0.05, C:-0.10}, "26-35": {I:0.10, D:0.15, S:0.05, C:0.05}, "36-50": {D:0.20, C:0.15, S:0.10, I:0.05}, "51-65": {S:0.20, C:0.10, D:0.05, I:-0.05}, "65+": {S:0.25, C:0.05, D:-0.10, I:-0.15} },
                    family_status: { single: {I:0.15, D:0.10, S:-0.05, C:0.05}, couple: {I:0.10, D:0.05, S:0.10, C:0.10}, family: {S:0.20, C:0.10, D:0.05, I:0.05} }
                }
            },
            demographic_options: {
                age: { label: {pl: "Przedzia≈Ç wiekowy", en: "Age Range"}, options: { none: {pl: "Nieznany", en: "Unknown"}, "18-25": "18-25", "26-35": "26-35", "36-50": "36-50", "51-65": "51-65", "65+": "65+" } },
                family_status: { label: {pl: "Status rodzinny", en: "Family Status"}, options: { none: {pl: "Nieznany", en: "Unknown"}, single: {pl: "Singiel/ka", en: "Single"}, couple: {pl: "Para", en: "Couple"}, family: {pl: "Rodzina", en: "Family"} } }
            },
            context_options: [ 
                { id: 'solar_panels', label: {pl: "Posiada Panele PV", en: "Has Solar Panels"} }, 
                { id: 'business_context', label: {pl: "Prowadzi firmƒô", en: "Runs a Business"} }, 
                { id: 'family_context', label: {pl: "Ma rodzinƒô", en: "Has a Family"} } 
            ],
            trigger_categories: { 
                "financial": {pl: "üí∞ Finanse i Koszty", en: "üí∞ Finance & Costs"}, 
                "technical": {pl: "‚öôÔ∏è Techniczne i Praktyczne", en: "‚öôÔ∏è Technical & Practical"}, 
                "infrastructure": {pl: "üè† Infrastruktura", en: "üè† Infrastructure"},
                "competitive": {pl: "üèÅ Por√≥wnania i Konkurencja", en: "üèÅ Comparisons & Competition"},
                "timing": {pl: "‚è∞ Czas i Proces Decyzyjny", en: "‚è∞ Timing & Decision Process"},
                "family_context": {pl: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Kontekst Rodzinny", en: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Context"},
                "brand_perception": {pl: "üè¢ Postrzeganie Marki", en: "üè¢ Brand Perception"}
            },
            triggers: [
                { id: 'price_concern', text: {pl: "Cena jest za wysoka / To za drogo", en: "The price is too high / It's too expensive"}, category: "financial", personality_resonance: {"S": 10, "C": 9, "D": 5, "I": 4}, archetypes: ['budget_conscious_family', 'cautious_adopter'], impact_score: 9, objection_id: 'OBJ_PRICE_HIGH', fun_drive_score: -8, responses: { default: {pl: "Rozumiem, to du≈ºa inwestycja. Sp√≥jrzmy na ca≈Çkowity koszt posiadania.", en: "I understand, it's a big investment. Let's look at the total cost of ownership."} } },
                { id: 'financial_q', text: {pl: "Jakie sƒÖ opcje finansowania/leasingu?", en: "What are the financing/leasing options?"}, category: "financial", personality_resonance: {"C": 10, "S": 8, "D": 6, "I": 5}, archetypes: ['budget_conscious_family', 'data_driven_professional', 'fleet_manager'], impact_score: 8, fun_drive_score: -6, responses: { default: {pl: "Oczywi≈õcie, mamy kilka opcji. Por√≥wnajmy kredyt z leasingiem.", en: "Of course, we have several options. Let's compare a loan with a lease."} } },
                { id: 'gov_programs', text: {pl: "Jakie sƒÖ programy rzƒÖdowe i dop≈Çaty?", en: "What are the government programs and subsidies?"}, category: "financial", personality_resonance: {"S": 9, "C": 9, "I": 6, "D": 5}, archetypes: ['budget_conscious_family', 'eco_economist'], impact_score: 8, fun_drive_score: -5, responses: { default: {pl: "≈öwietne pytanie! Program 'NaszEauto' to realna oszczƒôdno≈õƒá.", en: "Great question! The 'OurEV' program is a real saving."} } },
                { id: 'range_anxiety', text: {pl: "Bojƒô siƒô o zasiƒôg, zw≈Çaszcza zimƒÖ", en: "I'm worried about the range, especially in winter"}, category: "technical", personality_resonance: {"S": 10, "C": 9, "D": 6, "I": 4}, archetypes: ['safety_first_parents', 'cautious_adopter'], impact_score: 8, objection_id: 'OBJ_RANGE_WINTER', fun_drive_score: 2, responses: { default: {pl: "To najczƒôstsza obawa, kt√≥ra znika po pierwszym tygodniu.", en: "That's the most common concern, and it disappears after the first week."} } },
                { id: 'battery_degradation', text: {pl: "Bojƒô siƒô o degradacjƒô i ≈ºywotno≈õƒá baterii", en: "I'm worried about battery degradation and lifespan"}, category: "technical", personality_resonance: {"C": 10, "S": 9, "D": 5, "I": 4}, archetypes: ['data_driven_professional', 'cautious_adopter'], impact_score: 7, fun_drive_score: -2, responses: { default: {pl: "Nasze baterie sƒÖ projektowane na lata, a gwarancja to potwierdza.", en: "Our batteries are designed for years, and the warranty confirms it."} } },
                { id: 'performance_interest', text: {pl: "Interesuje mnie wydajno≈õƒá i przyspieszenie", en: "I'm interested in performance and acceleration"}, category: "technical", personality_resonance: {"D": 10, "I": 8, "C": 5, "S": 3}, archetypes: ['performance_enthusiast', 'tech_executive'], impact_score: 7, fun_drive_score: 6, responses: { default: {pl: "W takim razie jest Pan w dobrym miejscu! Um√≥wmy siƒô na jazdƒô pr√≥bnƒÖ.", en: "Then you've come to the right place! Let's schedule a test drive."} } },
                { id: 'charging_infrastructure_concern', text: {pl: "Obawiam siƒô o infrastrukturƒô ≈Çadowania / dostƒôpno≈õƒá ≈Çadowarek", en: "I'm concerned about charging infrastructure / charger availability"}, category: "infrastructure", personality_resonance: {"S": 10, "C": 9, "D": 4, "I": 3}, archetypes: ['cautious_adopter', 'safety_first_parents'], impact_score: 8, fun_drive_score: 1, responses: { default: {pl: "To wa≈ºna kwestia. Sieƒá Supercharger√≥w Tesli jest najszybsza i najbardziej niezawodna w Polsce.", en: "That's an important point. Tesla's Supercharger network is the fastest and most reliable in Poland."} } },
                { id: 'no_charging_place', text: {pl: "Nie mam gdzie ≈Çadowaƒá / ≈Åadowanie jest k≈Çopotliwe", en: "I have nowhere to charge / Charging is a hassle"}, category: "infrastructure", personality_resonance: {"S": 10, "C": 8, "D": 4, "I": 3}, archetypes: ['cautious_adopter', 'luxury_traditionalist'], impact_score: 8, fun_drive_score: 0, responses: { default: {pl: "Sprawd≈∫my, jakie sƒÖ opcje w Pana okolicy. Czƒôsto jest ich wiƒôcej, ni≈º siƒô wydaje.", en: "Let's check the options in your area. There are often more than you think."} } },
                { id: 'compare_bmw', text: {pl: "Por√≥wnujƒô z BMW iX3", en: "I'm comparing with the BMW iX3"}, category: "competitive", personality_resonance: {"D": 8, "C": 8, "I": 6, "S": 5}, archetypes: ['luxury_traditionalist', 'performance_enthusiast'], impact_score: 7, competitor_id: 'bmw_ix3', fun_drive_score: -3, responses: { default: {pl: "To ≈õwietne auto, ale Tesla oferuje unikalny ekosystem i technologiƒô.", en: "That's a great car, but Tesla offers a unique ecosystem and technology."} } },
                { id: 'compare_audi', text: {pl: "Por√≥wnujƒô z Audi Q4 e-tron", en: "I'm comparing with the Audi Q4 e-tron"}, category: "competitive", personality_resonance: {"D": 8, "C": 8, "I": 6, "S": 5}, archetypes: ['luxury_traditionalist', 'data_driven_professional'], impact_score: 7, competitor_id: 'audi_q4_etron', fun_drive_score: -3, responses: { default: {pl: "Rozumiem, Q4 ma ≈õwietne wnƒôtrze. Por√≥wnajmy koszty i technologiƒô.", en: "I understand, the Q4 has a great interior. Let's compare costs and technology."} } },
                { id: 'procrastination', text: {pl: "Muszƒô siƒô zastanowiƒá / Mo≈ºe powinienem poczekaƒá", en: "I need to think about it / Maybe I should wait"}, category: "timing", personality_resonance: {"S": 10, "C": 9, "I": 5, "D": 4}, archetypes: ['cautious_adopter', 'luxury_traditionalist'], impact_score: 5, fun_drive_score: 3, responses: { default: {pl: "Oczywi≈õcie. Co konkretnie powstrzymuje Pana przed decyzjƒÖ ju≈º dzi≈õ?", en: "Of course. What specifically is holding you back from deciding today?"} } },
                { id: 'fast_purchase', text: {pl: "Chcƒô kupiƒá jak najszybciej, jaki jest czas oczekiwania?", en: "I want to buy ASAP, what's the waiting time?"}, category: "timing", personality_resonance: {"D": 10, "I": 8, "S": 5, "C": 5}, archetypes: ['early_adopter', 'business_optimizer'], impact_score: 9, fun_drive_score: -10, responses: { default: {pl: "≈öwietnie! Sprawd≈∫my dostƒôpne od rƒôki modele.", en: "Great! Let's check the models available immediately."} } },
                { id: 'family_practicality', text: {pl: "Czy to praktyczne auto dla rodziny z dzieƒámi?", en: "Is it a practical car for a family with kids?"}, category: "family_context", personality_resonance: {"S": 10, "C": 8, "I": 7, "D": 6}, archetypes: ['safety_first_parents', 'green_pioneer_family'], impact_score: 8, fun_drive_score: -4, responses: { default: {pl: "Model Y zosta≈Ç zaprojektowany z my≈õlƒÖ o rodzinach. Bezpiecze≈Ñstwo i przestrze≈Ñ to priorytety.", en: "The Model Y was designed with families in mind. Safety and space are priorities."} } },
                { id: 'spouse_consult', text: {pl: "Muszƒô to skonsultowaƒá z ≈ºonƒÖ/mƒô≈ºem", en: "I need to consult my wife/husband"}, category: "family_context", personality_resonance: {"S": 10, "I": 7, "C": 6, "D": 5}, archetypes: ['safety_first_parents', 'green_pioneer_family'], impact_score: 6, fun_drive_score: -1, responses: { default: {pl: "Oczywi≈õcie, to wsp√≥lna decyzja. Mo≈ºe um√≥wimy jazdƒô pr√≥bnƒÖ dla Pa≈Ñstwa obojga?", en: "Of course, it's a joint decision. Perhaps we can schedule a test drive for you both?"} } },
                { id: 'musk_concern', text: {pl: "Wizerunek Elona Muska mnie zniechƒôca", en: "Elon Musk's image discourages me"}, category: "brand_perception", personality_resonance: {"I": 8, "S": 7, "C": 6, "D": -2}, archetypes: ['luxury_traditionalist', 'eco_economist'], impact_score: 4, fun_drive_score: 5, responses: { default: {pl: "Rozumiem. Skupmy siƒô na produkcie, jego technologii i zaletach dla Pana.", en: "I understand. Let's focus on the product, its technology, and the benefits for you."} } }
            ],
            disc_profiles: {
                D: { name: {pl: "DominujƒÖcy", en: "Dominant"}, description: {pl: "Zorientowany na cel, szybki w dzia≈Çaniu, lubi kontrolƒô i wyzwania. Chce najlepszych wynik√≥w i przewagi.", en: "Goal-oriented, fast-acting, likes control and challenges. Wants the best results and an advantage."}},
                I: { name: {pl: "Wp≈Çywowy", en: "Influential"}, description: {pl: "Entuzjastyczny, towarzyski, optymistyczny. Lubi nowo≈õci, bycie w centrum uwagi i dzielenie siƒô do≈õwiadczeniami.", en: "Enthusiastic, sociable, optimistic. Likes novelty, being the center of attention, and sharing experiences."}},
                S: { name: {pl: "Sta≈Çy", en: "Steady"}, description: {pl: "Spokojny, lojalny, ceni bezpiecze≈Ñstwo i stabilno≈õƒá. Potrzebuje czasu, gwarancji i zaufania.", en: "Calm, loyal, values security and stability. Needs time, guarantees, and trust."}},
                C: { name: {pl: "Sumienny", en: "Conscientious"}, description: {pl: "Analityczny, precyzyzy, ceni fakty, dane i jako≈õƒá. Potrzebuje dowod√≥w i logicznych argument√≥w.", en: "Analytical, precise, values facts, data, and quality. Needs proof and logical arguments."}}
            },
            archetypes: {
                'green_pioneer_family': { name: {pl: "Zielona Rodzina Pionier√≥w", en: "Green Pioneer Family"}, weekend_test_drive_potential: 7, description: {pl: "Rodzina, dla kt√≥rej warto≈õci ekologiczne i przysz≈Ço≈õƒá dzieci sƒÖ r√≥wnie wa≈ºne co bezpiecze≈Ñstwo i rozsƒÖdne koszty.", en: "A family for whom ecological values and their children's future are as important as safety and reasonable costs."}, strategy: { opening_line: {pl: "Czy wyobra≈ºajƒÖ sobie Pa≈Ñstwo wakacje, podczas kt√≥rych nie tylko oszczƒôdzacie na paliwie, ale te≈º zostawiacie czystszy ≈õwiat dla swoich dzieci?", en: "Can you imagine a vacation where you not only save on fuel but also leave a cleaner world for your children?"}, argument_stack: { soft: {pl: "Tesla eliminuje 100% lokalnych emisji spalin.", en: "Tesla eliminates 100% of local tailpipe emissions."}, medium: {pl: "Model Y ma 5-gwiazdkowy rating bezpiecze≈Ñstwa w ka≈ºdej kategorii.", en: "The Model Y has a 5-star safety rating in every category."}, strong: {pl: "Z panelami PV je≈∫dzicie Pa≈Ñstwo praktycznie za darmo.", en: "With solar panels, you drive practically for free."} }, social_proof: {pl: "Case study polskiej rodziny z fotowoltaikƒÖ.", en: "Case study of a family with photovoltaics."}, roi_hook: {pl: "Miesiƒôczne oszczƒôdno≈õci na paliwie to rata za wakacje.", en: "Monthly fuel savings can cover a vacation installment."}, next_question: {pl: "Ile kilometr√≥w miesiƒôcznie pokonujƒÖ Pa≈Ñstwo ca≈ÇƒÖ rodzinƒÖ?", en: "How many kilometers does your family travel per month?"}, recommended_techniques: ['benefits_language', 'social_proof'] } },
                'safety_first_parents': { name: {pl: "Rodzice StawiajƒÖcy na Bezpiecze≈Ñstwo", en: "Safety-First Parents"}, weekend_test_drive_potential: 8, description: {pl: "Priorytetem jest ochrona rodziny, bazujƒÖ na faktach dotyczƒÖcych bezpiecze≈Ñstwa i niezawodno≈õci.", en: "The priority is family protection, relying on facts about safety and reliability."}, strategy: { opening_line: {pl: "Wiem, ≈ºe bezpiecze≈Ñstwo jest dla Pana absolutnym priorytetem. Porozmawiajmy o tym, dlaczego Tesla jest jednym z najbezpieczniejszych aut na ≈õwiecie.", en: "I know that safety is your absolute priority. Let's talk about why Tesla is one of the safest cars in the world."}, argument_stack: { soft: {pl: "Konstrukcja Tesli z nisko po≈Ço≈ºonƒÖ bateriƒÖ drastycznie obni≈ºa ryzyko dachowania.", en: "Tesla's design with a low-placed battery drastically reduces the risk of rollover."}, medium: {pl: "Systemy jak automatyczne hamowanie awaryjne dzia≈ÇajƒÖ non-stop, by chroniƒá Pana rodzinƒô.", en: "Systems like automatic emergency braking work non-stop to protect your family."}, strong: {pl: "Tesla Model Y otrzyma≈Ç najwy≈ºsze mo≈ºliwe oceny bezpiecze≈Ñstwa od Euro NCAP i NHTSA.", en: "The Tesla Model Y received the highest possible safety ratings from Euro NCAP and NHTSA."} }, social_proof: {pl: "Link do oficjalnych wynik√≥w i wideo z test√≥w zderzeniowych Euro NCAP.", en: "Link to official results and videos of Euro NCAP crash tests."}, roi_hook: {pl: "Spok√≥j ducha jest bezcenny.", en: "Peace of mind is priceless."}, next_question: {pl: "Kt√≥ry aspekt bezpiecze≈Ñstwa jest dla Pana najwa≈ºniejszy?", en: "Which aspect of safety is most important to you?"}, recommended_techniques: ['authority', 'social_proof'] } },
                'budget_conscious_family': { name: {pl: "Rodzina z Ograniczonym Bud≈ºetem", en: "Budget-Conscious Family"}, weekend_test_drive_potential: 6, description: {pl: "Skupieni na ca≈Çkowitym koszcie posiadania (TCO), szukajƒÖ maksymalnych oszczƒôdno≈õci i dotacji.", en: "Focused on the total cost of ownership (TCO), looking for maximum savings and subsidies."}, strategy: { opening_line: {pl: "Rozumiem, ≈ºe bud≈ºet jest kluczowy. Sp√≥jrzmy na liczby i zobaczmy, jak Tesla mo≈ºe byƒá bardziej op≈Çacalna ni≈º auto spalinowe.", en: "I understand that budget is key. Let's look at the numbers and see how a Tesla can be more cost-effective than a gasoline car."}, argument_stack: { soft: {pl: "Dziƒôki dotacji 'M√≥j Elektryk' cena jest ni≈ºsza nawet o 27 000 z≈Ç.", en: "Thanks to the 'My Electrician' subsidy, the price is lower by up to PLN 27,000."}, medium: {pl: "Miesiƒôczne oszczƒôdno≈õci na paliwie to czƒôsto 400-600 z≈Ç.", en: "Monthly fuel savings are often PLN 400-600."}, strong: {pl: "Ca≈Çkowity koszt posiadania (TCO) na 5 lat jest o ok. 30 000 z≈Ç ni≈ºszy ni≈º por√≥wnywalnego SUVa.", en: "The total cost of ownership (TCO) over 5 years is about PLN 30,000 lower than a comparable SUV."} }, social_proof: {pl: "Interaktywny kalkulator TCO online.", en: "Interactive TCO calculator online."}, roi_hook: {pl: "Oszczƒôdno≈õƒá 7 000 ‚Äì 9 000 z≈Ç rocznie na paliwie i serwisie.", en: "Savings of 7,000 - 9,000 PLN annually on fuel and service."}, next_question: {pl: "Jakie sƒÖ Pa≈Ñstwa obecne miesiƒôczne wydatki na paliwo i serwis?", en: "What are your current monthly expenses for fuel and service?"}, recommended_techniques: ['framing', 'scarcity_ethical'] } },
                'cautious_adopter': { name: {pl: "Ostro≈ºny Adopter", en: "Cautious Adopter"}, weekend_test_drive_potential: 8, description: {pl: "Ostro≈ºny, unika ryzyka, potrzebuje dowod√≥w na niezawodno≈õƒá. Boi siƒô byƒá 'kr√≥likiem do≈õwiadczalnym'.", en: "Cautious, avoids risk, needs proof of reliability. Afraid of being a 'guinea pig'."}, strategy: { opening_line: {pl: "Rozumiem Pana ostro≈ºno≈õƒá. Skupmy siƒô na faktach, kt√≥re pokazujƒÖ, jak dojrza≈ÇƒÖ technologiƒÖ jest dzi≈õ Tesla.", en: "I understand your caution. Let's focus on the facts that show how mature Tesla's technology is today."}, argument_stack: { soft: {pl: "Tesla produkuje auta od ponad 15 lat, a po drogach je≈∫dzi ich ponad 5 milion√≥w.", en: "Tesla has been producing cars for over 15 years, and there are over 5 million of them on the road."}, medium: {pl: "Na bateriƒô i napƒôd otrzymuje Pan 8 lat gwarancji.", en: "You get an 8-year warranty on the battery and drive unit."}, strong: {pl: "Model 3/Y to najlepiej sprzedajƒÖcy siƒô EV na ≈õwiecie.", en: "The Model 3/Y is the world's best-selling EV."} }, social_proof: {pl: "Raporty niezawodno≈õci od Consumer Reports lub TUV.", en: "Reliability reports from Consumer Reports or TUV."}, roi_hook: {pl: "Inwestycja w najd≈Çu≈ºej rozwijanƒÖ technologiƒô EV na rynku.", en: "An investment in the longest-developed EV technology on the market."}, next_question: {pl: "Jaki element technologii budzi Pana najwiƒôksze obawy?", en: "Which element of the technology raises your biggest concerns?"}, recommended_techniques: ['authority', 'social_proof'] } },
                'luxury_traditionalist': { name: {pl: "Luksusowy Tradycjonalista", en: "Luxury Traditionalist"}, weekend_test_drive_potential: 7, description: {pl: "Ceni komfort, jako≈õƒá wykonania i presti≈º znanych marek. Sceptyczny wobec minimalistycznego designu.", en: "Values comfort, build quality, and the prestige of well-known brands. Skeptical of minimalist design."}, strategy: { opening_line: {pl: "Rozumiem, ≈ºe jest Pan przyzwyczajony do najwy≈ºszych standard√≥w. Proponujƒô spojrzeƒá na Teslƒô jako na nowƒÖ definicjƒô luksusu.", en: "I understand you are accustomed to the highest standards. I suggest looking at Tesla as a new definition of luxury."}, argument_stack: { soft: {pl: "Absolutna cisza i brak wibracji zapewniajƒÖ nieosiƒÖgalny komfort akustyczny.", en: "Absolute silence and lack of vibrations provide unattainable acoustic comfort."}, medium: {pl: "Panoramiczny dach i minimalistyczne wnƒôtrze tworzƒÖ poczucie przestrzeni.", en: "The panoramic roof and minimalist interior create a sense of space."}, strong: {pl: "Oferujemy Serwis Mobilny, kt√≥ry przyje≈ºd≈ºa do Pana domu lub biura.", en: "We offer Mobile Service that comes to your home or office."} }, social_proof: {pl: "Opinie by≈Çych w≈Ça≈õcicieli BMW/Mercedes, kt√≥rzy przesiedli siƒô na Teslƒô.", en: "Testimonials from former BMW/Mercedes owners who switched to Tesla."}, roi_hook: {pl: "Luksus posiadania auta, kt√≥re samo siƒô aktualizuje.", en: "The luxury of owning a car that updates itself."}, next_question: {pl: "Co w Pana obecnym aucie definiuje dla Pana luksus?", en: "What defines luxury for you in your current car?"}, recommended_techniques: ['benefits_language', 'authority'] } },
                'performance_enthusiast': { name: {pl: "Entuzjasta OsiƒÖg√≥w", en: "Performance Enthusiast"}, weekend_test_drive_potential: 4, description: {pl: "Skupiony na przyspieszeniu, prowadzeniu i zaawansowaniu technicznym. Liczy siƒô adrenalina.", en: "Focused on acceleration, handling, and technical advancement. Adrenaline is what counts."}, strategy: { opening_line: {pl: "Je≈õli szuka Pan adrenaliny, nic nie przygotuje Pana na do≈õwiadczenie jazdy TeslƒÖ.", en: "If you're looking for adrenaline, nothing can prepare you for the experience of driving a Tesla."}, argument_stack: { soft: {pl: "Natychmiastowy moment obrotowy sprawia, ≈ºe jest szybsza w mie≈õcie od aut sportowych.", en: "Instant torque makes it faster in the city than sports cars."}, medium: {pl: "Dziƒôki baterii w pod≈Çodze ma ≈õrodek ciƒô≈ºko≈õci jak bolid F1.", en: "Thanks to the battery in the floor, it has a center of gravity like an F1 car."}, strong: {pl: "Model 3 Performance z trybem 'Track Mode' to bro≈Ñ na torze wy≈õcigowym.", en: "The Model 3 Performance with 'Track Mode' is a weapon on the racetrack."} }, social_proof: {pl: "Wideo z wy≈õcig√≥w na 1/4 mili, gdzie Tesla wygrywa z supersamochodami.", en: "Video from 1/4 mile races where Tesla beats supercars."}, roi_hook: {pl: "OsiƒÖgi Porsche 911 w cenie rodzinnego sedana.", en: "Porsche 911 performance at the price of a family sedan."}, next_question: {pl: "Chce Pan porozmawiaƒá o liczbach, czy poczuƒá to przyspieszenie?", en: "Do you want to talk numbers, or feel that acceleration?"}, recommended_techniques: ['benefits_language'] } },
                'data_driven_professional': { name: {pl: "Profesjonalista OpierajƒÖcy siƒô na Danych", en: "Data-Driven Professional"}, weekend_test_drive_potential: 9, description: {pl: "Podejmuje decyzje w oparciu o twarde dane, analizy i ROI. Emocje majƒÖ drugorzƒôdne znaczenie.", en: "Makes decisions based on hard data, analysis, and ROI. Emotions are secondary."}, strategy: { opening_line: {pl: "Rozumiem, ≈ºe liczƒÖ siƒô fakty. Przygotowa≈Çem zestawienie danych, aby m√≥g≈Ç Pan dokonaƒá ≈õwiadomej analizy.", en: "I understand that facts matter. I have prepared a data summary so you can make an informed analysis."}, argument_stack: { soft: {pl: "Koszt przejechania 100 km to oko≈Ço 12 z≈Ç przy ≈Çadowaniu w domu.", en: "The cost of driving 100 km is about PLN 12 when charging at home."}, medium: {pl: "Model Y ma jeden z najni≈ºszych wsp√≥≈Çczynnik√≥w oporu powietrza w klasie (0.23).", en: "The Model Y has one of the lowest drag coefficients in its class (0.23)."}, strong: {pl: "Analiza TCO na 5 lat w por√≥wnaniu do Audi Q5 pokazuje, ≈ºe Tesla jest ta≈Ñsza o ponad 40 000 z≈Ç.", en: "A 5-year TCO analysis compared to an Audi Q5 shows that the Tesla is over PLN 40,000 cheaper."} }, social_proof: {pl: "Link do niezale≈ºnego raportu technicznego (np. od Bj√∏rna Nylanda).", en: "Link to an independent technical report (e.g., from Bj√∏rn Nyland)."}, roi_hook: {pl: "ROI z inwestycji w Teslƒô vs auto spalinowe wynosi ok. 15% rocznie.", en: "The ROI on a Tesla investment vs. a gasoline car is about 15% annually."}, next_question: {pl: "Kt√≥ry parametr jest dla Pana kluczowy do dalszej analizy?", en: "Which parameter is key for your further analysis?"}, recommended_techniques: ['authority', 'framing'] } },
                'eco_economist': { name: {pl: "Eko-Ekonomista", en: "Eco-Economist"}, weekend_test_drive_potential: 6, description: {pl: "≈ÅƒÖczy troskƒô o ≈õrodowisko z analizƒÖ ekonomicznƒÖ. Chce, aby ekologia mu siƒô op≈Çaca≈Ça.", en: "Combines environmental concerns with economic analysis. Wants ecology to be profitable for them."}, strategy: { opening_line: {pl: "Szuka Pan rozwiƒÖzania inteligentnego dla portfela i dla planety. Sp√≥jrzmy na Teslƒô jak na system, kt√≥ry to ≈ÇƒÖczy.", en: "You're looking for a solution that's smart for your wallet and the planet. Let's look at Tesla as a system that combines both."}, argument_stack: { soft: {pl: "Tesla publikuje roczne raporty wp≈Çywu, pokazujƒÖc transparentnie ≈õlad wƒôglowy.", en: "Tesla publishes annual impact reports, transparently showing its carbon footprint."}, medium: {pl: "Po≈ÇƒÖczenie Tesli z fotowoltaikƒÖ to synergia idealna.", en: "Combining a Tesla with photovoltaics is the perfect synergy."}, strong: {pl: "Analiza LCA pokazuje, ≈ºe Tesla ma ni≈ºszy ≈õlad wƒôglowy ni≈º auto spalinowe ju≈º po 2-3 latach.", en: "LCA analysis shows that a Tesla has a lower carbon footprint than a gasoline car after just 2-3 years."} }, social_proof: {pl: "Link do oficjalnego raportu 'Tesla Impact Report'.", en: "Link to the official 'Tesla Impact Report'."}, roi_hook: {pl: "Inwestycja w niezale≈ºno≈õƒá energetycznƒÖ.", en: "An investment in energy independence."}, next_question: {pl: "Co jest wa≈ºniejsze: analiza ≈õladu wƒôglowego czy symulacja oszczƒôdno≈õci z PV?", en: "What's more important: carbon footprint analysis or PV savings simulation?"}, recommended_techniques: ['framing', 'authority'] } },
                'early_adopter': { name: {pl: "Wczesny Adopter", en: "Early Adopter"}, weekend_test_drive_potential: 3, description: {pl: "Podekscytowany nowo≈õciami, chce byƒá pierwszy i kreowaƒá trendy. Kupuje wizjƒô i emocje.", en: "Excited by novelty, wants to be first and set trends. Buys into the vision and emotions."}, strategy: { opening_line: {pl: "Widzƒô, ≈ºe interesuje Pana przysz≈Ço≈õƒá motoryzacji. Tesla tƒô przysz≈Ço≈õƒá tworzy, a Pan mo≈ºe byƒá jej czƒô≈õciƒÖ.", en: "I see you're interested in the future of mobility. Tesla is creating that future, and you can be a part of it."}, argument_stack: { soft: {pl: "Co kilka tygodni dostaje Pan aktualizacje z nowymi funkcjami.", en: "You get updates with new features every few weeks."}, medium: {pl: "Bƒôdzie Pan naturalnym liderem opinii i wyznacza≈Ç trendy w okolicy.", en: "You will be a natural opinion leader and trendsetter in your area."}, strong: {pl: "Dostƒôp do funkcji FSD beta daje Panu wglƒÖd w technologiƒô przysz≈Ço≈õci.", en: "Access to the FSD beta gives you a glimpse into the technology of the future."} }, social_proof: {pl: "Historie i blogi pierwszych w≈Ça≈õcicieli Tesli w Polsce.", en: "Stories and blogs of the first Tesla owners in Poland."}, roi_hook: {pl: "Warto≈õƒá bycia pierwszym jest niemierzalna.", en: "The value of being first is immeasurable."}, next_question: {pl: "Kt√≥ra z nadchodzƒÖcych funkcji Tesli ekscytuje Pana najbardziej?", en: "Which of Tesla's upcoming features excites you the most?"}, recommended_techniques: ['social_proof', 'benefits_language'] } },
                'business_optimizer': { name: {pl: "Optymalizator Biznesowy", en: "Business Optimizer"}, weekend_test_drive_potential: 7, description: {pl: "Analizuje korzy≈õci dla firmy, TCO i ROI. Samoch√≥d to zas√≥b, kt√≥ry ma zarabiaƒá.", en: "Analyzes benefits for the company, TCO, and ROI. The car is an asset that is supposed to earn money."}, strategy: { opening_line: {pl: "Traktuje Pan samoch√≥d jako inwestycjƒô. Porozmawiajmy, jak Tesla mo≈ºe staƒá siƒô rentownym aktywem.", en: "You treat the car as an investment. Let's talk about how a Tesla can become a profitable asset."}, argument_stack: { soft: {pl: "Wy≈ºszy limit amortyzacji (225 tys. z≈Ç) to konkretna korzy≈õƒá.", en: "The higher depreciation limit (PLN 225k) is a concrete benefit."}, medium: {pl: "Brak przeglƒÖd√≥w olejowych oznacza minimalne przestoje floty.", en: "No oil changes means minimal fleet downtime."}, strong: {pl: "TCO dla Tesli w firmie jest o 30-40% ni≈ºszy ni≈º dla auta premium.", en: "The TCO for a Tesla in a company is 30-40% lower than for a premium car."} }, social_proof: {pl: "Case study firmy, kt√≥ra wymieni≈Ça flotƒô na Tesle.", en: "Case study of a company that replaced its fleet with Teslas."}, roi_hook: {pl: "ROI na poziomie 20% rocznie dziƒôki oszczƒôdno≈õciom i podatkom.", en: "An ROI of 20% annually thanks to savings and taxes."}, next_question: {pl: "Ile aut ma Pan w firmie? Przygotujƒô symulacjƒô TCO.", en: "How many cars do you have in your company? I'll prepare a TCO simulation."}, recommended_techniques: ['framing', 'authority'] } },
                'fleet_manager': { name: {pl: "Fleet Manager", en: "Fleet Manager"}, weekend_test_drive_potential: 8, description: {pl: "ZarzƒÖdza flotƒÖ pojazd√≥w w firmie, skupiony na TCO, niezawodno≈õci i minimalizacji przestoj√≥w.", en: "Manages a company's vehicle fleet, focused on TCO, reliability, and minimizing downtime."}, strategy: { opening_line: {pl: "Wiem, ≈ºe zarzƒÖdzanie flotƒÖ to optymalizacja koszt√≥w i maksymalna niezawodno≈õƒá. Poka≈ºƒô Panu, jak Tesla rewolucjonizuje oba te obszary.", en: "I know that fleet management is about cost optimization and maximum reliability. Let me show you how Tesla revolutionizes both of these areas."}, argument_stack: { soft: {pl: "Brak wymiany oleju, filtr√≥w czy ≈õwiec zap≈Çonowych oznacza niemal zerowe koszty regularnych przeglƒÖd√≥w.", en: "No oil, filter, or spark plug changes mean almost zero regular maintenance costs."}, medium: {pl: "Zdalna diagnostyka i serwis mobilny minimalizujƒÖ przestoje pojazd√≥w do absolutnego minimum.", en: "Remote diagnostics and mobile service minimize vehicle downtime to an absolute minimum."}, strong: {pl: "Ca≈Çkowity koszt posiadania (TCO) Tesli we flocie jest o 30-50% ni≈ºszy w por√≥wnaniu do aut spalinowych klasy premium.", en: "The total cost of ownership (TCO) for a Tesla in a fleet is 30-50% lower compared to premium combustion cars."} }, social_proof: {pl: "Case study du≈ºej firmy, kt√≥ra zelektryfikowa≈Ça flotƒô i obni≈ºy≈Ça koszty o 40%.", en: "Case study of a large company that electrified its fleet and reduced costs by 40%."}, roi_hook: {pl: "Ka≈ºde 100 000 km to oszczƒôdno≈õƒá rzƒôdu 25 000 z≈Ç na samym paliwie i serwisie w por√≥wnaniu do diesla.", en: "Every 100,000 km saves around 25,000 PLN on fuel and service alone compared to a diesel."}, next_question: {pl: "Z ilu pojazd√≥w sk≈Çada siƒô Pana flota i jakie sƒÖ ≈õrednie roczne przebiegi?", en: "How many vehicles are in your fleet and what are the average annual mileages?"}, recommended_techniques: ['framing', 'authority'] } },
                'tech_executive': { name: {pl: "Tech Executive", en: "Tech Executive"}, weekend_test_drive_potential: 7, description: {pl: "Lider technologiczny, dla kt√≥rego samoch√≥d jest wizyt√≥wkƒÖ innowacyjno≈õci i statusu. Ceni wydajno≈õƒá, technologiƒô i wizerunek.", en: "A technology leader for whom a car is a showcase of innovation and status. Values performance, technology, and image."}, strategy: { opening_line: {pl: "Najbardziej zaawansowana AI-platforma na ko≈Çach, z flotƒÖ > 2 mln pojazd√≥w trenujƒÖcych Dojo.", en: "The most advanced AI platform on wheels, with a fleet of > 2 million vehicles training Dojo."}, argument_stack: { soft: {pl: "Pa≈Ñskie auto bƒôdzie stawa≈Ço siƒô lepsze z czasem dziƒôki bezp≈Çatnym aktualizacjom oprogramowania, kt√≥re dodajƒÖ nowe funkcje.", en: "Your car will get better over time with free software updates that add new features."}, medium: {pl: "Przyspieszenie i responsywno≈õƒá napƒôdu elektrycznego to do≈õwiadczenie, kt√≥rego nie da siƒô por√≥wnaƒá z ≈ºadnym autem spalinowym.", en: "The acceleration and responsiveness of the electric drive is an experience that cannot be compared to any combustion engine car."}, strong: {pl: "Model S Plaid to nie tylko samoch√≥d, to manifestacja technologicznej dominacji - najszybszy seryjny pojazd na ≈õwiecie.", en: "The Model S Plaid is not just a car, it's a statement of technological dominance - the fastest production vehicle in the world."} }, social_proof: {pl: "Artyku≈Çy w 'Wired' lub 'MIT Technology Review' opisujƒÖce Teslƒô jako prze≈Çom technologiczny.", en: "Articles in 'Wired' or 'MIT Technology Review' describing Tesla as a technological breakthrough."}, roi_hook: {pl: "Inwestycja w markƒô, kt√≥ra jest synonimem przysz≈Ço≈õci i innowacji.", en: "An investment in a brand that is synonymous with the future and innovation."}, next_question: {pl: "Kt√≥ry aspekt technologiczny - oprogramowanie, osiƒÖgi czy autonomiczna jazda - jest dla Pana najbardziej ekscytujƒÖcy?", en: "Which technological aspect - software, performance, or autonomous driving - is most exciting for you?"}, recommended_techniques: ['social_proof', 'benefits_language'] } }
            },
            model_recommendations: {
                'green_pioneer_family': { model: "Model Y", justification: {pl: "Idealny dla rodziny dziƒôki przestronno≈õci i bezpiecze≈Ñstwu.", en: "Perfect for a family due to its spaciousness and safety."} },
                'tech_executive': { model: "Model S", justification: {pl: "Reprezentuje szczyt technologii i osiƒÖg√≥w, podkre≈õlajƒÖc status lidera.", en: "Represents the pinnacle of technology and performance, emphasizing a leader's status."} },
                'safety_first_parents': { model: "Model Y", justification: {pl: "Uznawany za jeden z najbezpieczniejszych samochod√≥w rodzinnych.", en: "Considered one of the safest family cars."} },
                'budget_conscious_family': { model: "Model 3 (RWD)", justification: {pl: "Najbardziej przystƒôpny cenowo model, oferujƒÖcy najni≈ºszy TCO.", en: "The most affordable model, offering the lowest TCO."} },
                'cautious_adopter': { model: "Model Y", justification: {pl: "Najlepiej sprzedajƒÖcy siƒô i najd≈Çu≈ºej testowany na masowƒÖ skalƒô model.", en: "The best-selling and most extensively tested model on a mass scale."} },
                'fleet_manager': { model: "Model Y Long Range", justification: {pl: "Optymalny wyb√≥r dla flot dziƒôki niskiemu TCO, du≈ºemu zasiƒôgowi i minimalnym kosztom serwisowym.", en: "The optimal choice for fleets due to low TCO, long range, and minimal service costs."} },
                'default': { model: "Model Y", justification: {pl: "Wszechstronny wyb√≥r pasujƒÖcy do wielu potrzeb.", en: "A versatile choice that fits many needs."} }
            }
        };
        
        // --- MAIN APPLICATION LOGIC v13.0 ---
        document.addEventListener('DOMContentLoaded', () => {
            const langToggleButton = document.getElementById('lang-toggle');
            const analysisSection = document.getElementById('analysisSection');
            const analyzeButton = document.getElementById('analyzeButton');
            const resetButton = document.getElementById('resetButton');
            const deepDiveModal = document.getElementById('deepDiveModal');
            const closeDeepDiveButton = document.getElementById('closeDeepDiveButton');
            const applyDeepDiveButton = document.getElementById('applyDeepDiveButton');

            function setLanguage(lang) {
                currentLanguage = lang;
                document.documentElement.lang = lang;
                langToggleButton.textContent = lang === 'pl' ? 'EN' : 'PL';
                
                Object.keys(translations.pl).forEach(key => {
                    const element = document.getElementById(key.replace(/_/g, '-'));
                    if (element) {
                        element.textContent = translations[lang][key] || translations.pl[key];
                    }
                });
                
                const selectedData = getSelectedInputs();
                initializeUI(selectedData);

                if (!analysisSection.classList.contains('hidden')) {
                    const analysisResult = JSON.parse(analysisSection.dataset.analysisResult || '{}');
                    if (analysisResult.discScores) {
                        updateResultsUI(analysisResult);
                    }
                }
            }

            function getSelectedInputs() {
                const triggers = Array.from(document.querySelectorAll('input[data-type="trigger"]:checked')).map(cb => cb.id);
                const context = Array.from(document.querySelectorAll('input[data-type="context"]:checked')).map(cb => cb.id);
                const demographics = {};
                document.querySelectorAll('select[data-type="demographic"]').forEach(sel => {
                    demographics[sel.dataset.key] = sel.value;
                });
                return { triggers, context, demographics };
            }

            function initializeUI(selectedData = {triggers: [], context: [], demographics: {}}) {
                const lang = currentLanguage;
                const demographicsContainer = document.getElementById('demographicsContainer');
                const contextContainer = document.getElementById('contextContainer');
                const triggersContainer = document.getElementById('triggersContainer');

                // Demographics
                demographicsContainer.innerHTML = '';
                for (const key in a_database.demographic_options) {
                    const item = a_database.demographic_options[key];
                    let selectHtml = `<div><label for="demo-${key}" class="block text-sm font-medium text-gray-300 mb-1">${item.label[lang]}</label><select id="demo-${key}" data-type="demographic" data-key="${key}" class="w-full rounded-md border-gray-600 bg-gray-700 text-white focus:border-red-500 focus:ring-red-500 p-2">`;
                    for (const value in item.options) {
                        const optionText = typeof item.options[value] === 'object' ? item.options[value][lang] : item.options[value];
                        const isSelected = selectedData.demographics && selectedData.demographics[key] === value;
                        selectHtml += `<option value="${value}" ${isSelected ? 'selected' : ''}>${optionText}</option>`;
                    }
                    selectHtml += `</select></div>`;
                    demographicsContainer.innerHTML += selectHtml;
                }
                
                // Context
                contextContainer.innerHTML = '';
                a_database.context_options.forEach(info => {
                    const isChecked = selectedData.context.includes(info.id);
                    contextContainer.innerHTML += `<div id="card-${info.id}" class="card rounded-lg p-3 flex items-center ${isChecked ? 'selected' : ''}"><input id="${info.id}" type="checkbox" class="custom-checkbox h-4 w-4 rounded bg-gray-700 border-gray-600 focus:ring-red-500 pointer-events-none" data-type="context" ${isChecked ? 'checked' : ''}><span class="ml-3 text-sm font-medium text-white">${info.label[lang]}</span></div>`;
                });

                // Triggers
                triggersContainer.innerHTML = '';
                const groupedTriggers = a_database.triggers.reduce((acc, trigger) => {
                    const category = trigger.category;
                    if (!acc[category]) acc[category] = [];
                    acc[category].push(trigger);
                    return acc;
                }, {});

                for (const categoryId in a_database.trigger_categories) {
                    if (!groupedTriggers[categoryId]) continue;
                    const categoryName = a_database.trigger_categories[categoryId][lang];
                    let categoryHtml = `<div class="mb-6"><h3 class="text-xl font-semibold text-gray-300 mb-4">${categoryName}</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4">`;
                    groupedTriggers[categoryId].forEach(trigger => {
                        const isChecked = selectedData.triggers.includes(trigger.id);
                        const quickResponse = trigger.responses ? trigger.responses.default[lang] : '';
                        const hasDeepDive = deep_dive_data[trigger.id];

                        categoryHtml += `<div id="card-${trigger.id}" class="card rounded-lg p-4 ${isChecked ? 'selected' : ''}">
                                            <div class="flex items-start">
                                                <input id="${trigger.id}" type="checkbox" class="custom-checkbox h-5 w-5 rounded bg-gray-700 border-gray-600 focus:ring-red-500 mt-1 flex-shrink-0 pointer-events-none" data-type="trigger" ${isChecked ? 'checked' : ''}>
                                                <div class="ml-4 flex-1">
                                                    <p class="font-semibold text-white">${trigger.text[lang]}</p>
                                                    ${quickResponse ? `<p class="text-sm text-gray-400 mt-2"><span class="font-semibold text-gray-300">${translations[lang].quick_response}:</span> <span class="quick-response-text">${quickResponse}</span></p>` : ''}
                                                </div>
                                            </div>
                                            ${hasDeepDive ? `<div class="text-right mt-2"><button data-trigger-id="${trigger.id}" class="deep-dive-btn text-sm text-red-400 hover:text-red-300 font-semibold">${translations[lang].deep_dive_button}</button></div>` : ''}
                                         </div>`;
                    });
                    categoryHtml += `</div></div>`;
                    triggersContainer.innerHTML += categoryHtml;
                }

                document.querySelectorAll('.card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        if (e.target.classList.contains('deep-dive-btn')) return;
                        const checkbox = card.querySelector('input[type="checkbox"]');
                        if (checkbox) {
                            checkbox.checked = !checkbox.checked;
                            card.classList.toggle('selected', checkbox.checked);
                        }
                    });
                });

                document.querySelectorAll('.deep-dive-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        showDeepDiveModal(btn.dataset.triggerId);
                    });
                });
            }

            function showDeepDiveModal(triggerId) {
                const lang = currentLanguage;
                const questions = deep_dive_data[triggerId];
                if (!questions) return;

                const contentContainer = document.getElementById('deepDiveContent');
                document.getElementById('deepDiveTitle').textContent = translations[lang].deep_dive_title;
                document.getElementById('applyDeepDiveButton').textContent = translations[lang].deep_dive_apply;
                document.getElementById('closeDeepDiveButton').textContent = translations[lang].deep_dive_cancel;

                contentContainer.innerHTML = '';
                questions.forEach((q, index) => {
                    const isChecked = selectedDeepDive[triggerId] === q.id;
                    contentContainer.innerHTML += `
                        <label for="dd-q-${index}" class="flex items-center p-3 bg-gray-700 rounded-md cursor-pointer hover:bg-gray-600">
                            <input id="dd-q-${index}" type="radio" name="deep-dive-${triggerId}" value="${q.id}" class="custom-radio h-4 w-4 rounded-full" ${isChecked ? 'checked' : ''}>
                            <span class="ml-3 text-white text-sm">${q.text[lang]}</span>
                        </label>
                    `;
                });
                
                applyDeepDiveButton.onclick = () => {
                    const selectedRadio = contentContainer.querySelector(`input[name="deep-dive-${triggerId}"]:checked`);
                    if (selectedRadio) {
                        selectedDeepDive[triggerId] = selectedRadio.value;
                    } else {
                        delete selectedDeepDive[triggerId];
                    }
                    deepDiveModal.classList.add('hidden');
                };

                deepDiveModal.classList.remove('hidden');
            }
            
            closeDeepDiveButton.addEventListener('click', () => deepDiveModal.classList.add('hidden'));

            function runAdvancedAnalysis() {
                const { triggers: selectedTriggerIds, context: selectedContextIds, demographics: selectedDemographics } = getSelectedInputs();

                if (selectedTriggerIds.length === 0 && Object.values(selectedDemographics).every(v => v === 'none' || !v)) {
                    showModal(translations[currentLanguage].modal_error_text);
                    return null;
                }

                let discScores = { D: 1, I: 1, S: 1, C: 1 };
                let archetypeScores = {};
                let detectedObjectionIds = new Set();
                let detectedCompetitorIds = new Set();
                let unlockedPlaybookItems = new Set();
                let funDriveScore = 0;

                const selectedTriggers = a_database.triggers.filter(t => selectedTriggerIds.includes(t.id));

                selectedTriggers.forEach(trigger => {
                    const impactMultiplier = 1 + ((trigger.impact_score || 5) / 10);
                    
                    for (const type in trigger.personality_resonance) {
                        discScores[type] += trigger.personality_resonance[type] * impactMultiplier;
                    }
                    if (trigger.archetypes) {
                        trigger.archetypes.forEach(arch => {
                            archetypeScores[arch] = (archetypeScores[arch] || 0) + 1 * impactMultiplier;
                        });
                    }
                    if (trigger.objection_id) detectedObjectionIds.add(trigger.objection_id);
                    if (trigger.competitor_id) detectedCompetitorIds.add(trigger.competitor_id);
                    if (trigger.fun_drive_score) funDriveScore += trigger.fun_drive_score;
                });
                
                Object.keys(selectedDeepDive).forEach(triggerId => {
                    const selectedQuestionId = selectedDeepDive[triggerId];
                    const question = deep_dive_data[triggerId]?.find(q => q.id === selectedQuestionId);
                    if (question) {
                        for (const discType in question.modifiers) {
                            discScores[discType] *= (1 + question.modifiers[discType]);
                        }
                        if (question.playbook_unlock) {
                            unlockedPlaybookItems.add(question.playbook_unlock);
                        }
                    }
                });
                
                let demoCount = 0;
                Object.keys(selectedDemographics).forEach(key => {
                    const value = selectedDemographics[key];
                    if (value && value !== 'none') {
                        demoCount++;
                        const modifierGroup = a_database.config.demographic_modifiers[key];
                        if (modifierGroup && modifierGroup[value]) {
                            const modifiers = modifierGroup[value];
                            for (const discType in modifiers) {
                                discScores[discType] *= (1 + modifiers[discType]);
                            }
                        }
                    }
                });

                const totalScore = Object.values(discScores).reduce((sum, score) => sum + Math.max(0, score), 0);
                if (totalScore > 0) {
                    for (const type in discScores) {
                        discScores[type] = Math.max(0, (discScores[type] / totalScore) * 100 * 2.5);
                        discScores[type] = Math.min(100, discScores[type]);
                    }
                }

                const sortedDisc = Object.entries(discScores).sort((a, b) => b[1] - a[1]);
                const mainDiscType = sortedDisc.length > 0 && sortedDisc[0][1] > 0 ? sortedDisc[0][0] : 'S';
                
                const sortedArchetypes = Object.entries(archetypeScores).sort((a, b) => b[1] - a[1]);
                let mainArchetypeKey = "cautious_adopter"; // Default
                if (sortedArchetypes.length > 0 && sortedArchetypes[0][1] > 0) {
                    mainArchetypeKey = sortedArchetypes[0][0];
                }


                const confidence = calculateAdvancedConfidence(discScores, selectedTriggerIds.length, demoCount);
                const ovnPotential = a_database.archetypes[mainArchetypeKey]?.weekend_test_drive_potential || 5;

                return { discScores, mainDiscType, mainArchetypeKey, confidence, selectedContextIds, detectedObjectionIds: Array.from(detectedObjectionIds), detectedCompetitorIds: Array.from(detectedCompetitorIds), unlockedPlaybookItems: Array.from(unlockedPlaybookItems), funDriveScore, ovnPotential };
            }

            function calculateAdvancedConfidence(discScores, triggerCount, demoCount) {
                const scores = Object.values(discScores);
                const totalScore = scores.reduce((a, b) => a + b, 0);
                if (totalScore === 0) return 0;
                const sortedScores = [...scores].sort((a, b) => b - a);
                const dominance = sortedScores[0] > 0 ? (sortedScores[0] - sortedScores[1]) / sortedScores[0] : 0;
                const signalStrength = Math.min(dominance, 1.0);
                const completeness = Math.min((triggerCount + demoCount) / 8, 1.0);
                const confidence = (signalStrength * 0.6) + (completeness * 0.4);
                return Math.min(99, Math.round(confidence * 100));
            }
            
            function injectData(text, lang) {
                if (!text) return '(brak danych)';
                const subsidies = market_data.government_subsidies.nasz_eauto_program;
                const numberFormatter = new Intl.NumberFormat(lang === 'pl' ? 'pl-PL' : 'en-US');
                return text
                    .replace(/\[REMAINING_BUDGET\]/g, numberFormatter.format(subsidies.remaining_budget))
                    .replace(/\[DEPLETION_DATE\]/g, subsidies.estimated_depletion_date)
                    .replace(/\[SUBSIDY_AMOUNT\]/g, numberFormatter.format(subsidies.subsidy_amounts.business_lease_new_ev));
            }
            
            function updateResultsUI(analysisResult) {
                const lang = currentLanguage;
                analysisSection.dataset.analysisResult = JSON.stringify(analysisResult);
                
                const tabsContainer = document.getElementById('tabs');
                const tabContentContainer = document.getElementById('tabContent');

                const tabDefinitions = [
                    { id: 'summary', label: translations[lang].tabs.summary, builder: buildSummaryTab },
                    { id: 'communication', label: translations[lang].tabs.communication, builder: buildCommunicationTab },
                    { id: 'playbook', label: translations[lang].tabs.playbook, builder: buildPlaybookTab },
                    { id: 'objections', label: translations[lang].tabs.objections, builder: buildObjectionsTab, condition: analysisResult.detectedObjectionIds.length > 0 },
                    { id: 'competition', label: translations[lang].tabs.competition, builder: buildCompetitionTab, condition: analysisResult.detectedCompetitorIds.length > 0 },
                    { id: 'techniques', label: translations[lang].tabs.techniques, builder: buildTechniquesTab }
                ];
                
                tabsContainer.innerHTML = '';
                tabContentContainer.innerHTML = '';
                let isFirst = true;

                tabDefinitions.forEach(tabDef => {
                    if (tabDef.condition === false) return;

                    tabsContainer.innerHTML += `<button data-tab="${tabDef.id}" class="tab whitespace-nowrap py-3 px-2 sm:px-4 border-b-2 font-medium text-sm border-transparent text-gray-400 hover:text-white ${isFirst ? 'active' : ''}">${tabDef.label}</button>`;
                    tabContentContainer.innerHTML += `<div id="${tabDef.id}" class="p-4 ${isFirst ? '' : 'hidden'}">${tabDef.builder(analysisResult, lang)}</div>`;
                    isFirst = false;
                });

                const chartCanvas = document.getElementById('discRadarChart');
                if (chartCanvas) {
                    const { discScores } = analysisResult;
                    const chartData = {
                        labels: ['Dominant (D)', 'Influential (I)', 'Steady (S)', 'Conscientious (C)'],
                        datasets: [{
                            label: translations[lang].disc_radar_title,
                            data: [discScores.D, discScores.I, discScores.S, discScores.C],
                            fill: true, backgroundColor: 'rgba(239, 68, 68, 0.2)', borderColor: 'rgb(239, 68, 68)',
                            pointBackgroundColor: 'rgb(239, 68, 68)', pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff', pointHoverBorderColor: 'rgb(239, 68, 68)'
                        }]
                    };
                    if (discChart) discChart.destroy();
                    discChart = new Chart(chartCanvas, {
                        type: 'radar', data: chartData,
                        options: {
                            responsive: true, maintainAspectRatio: false,
                            scales: { r: { angleLines: { color: 'rgba(255, 255, 255, 0.2)' }, grid: { color: 'rgba(255, 255, 255, 0.2)' }, pointLabels: { color: '#e5e7eb', font: { size: 14 } }, ticks: { display: false, stepSize: 25 }, suggestedMin: 0, suggestedMax: 100 } },
                            plugins: { legend: { display: false } }
                        }
                    });
                }

                document.querySelectorAll('.tab').forEach(button => {
                    button.addEventListener('click', () => {
                        document.querySelectorAll('.tab').forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        document.querySelectorAll('#tabContent > div').forEach(content => content.classList.add('hidden'));
                        document.getElementById(button.dataset.tab).classList.remove('hidden');
                    });
                });
            }
            
            // --- TAB BUILDER FUNCTIONS ---

            function buildSummaryTab(result, lang) {
                const { mainDiscType, mainArchetypeKey, confidence, funDriveScore, ovnPotential } = result;
                const archetype = a_database.archetypes[mainArchetypeKey] || a_database.archetypes['cautious_adopter'];
                const discProfile = a_database.disc_profiles[mainDiscType];
                const recommendation = a_database.model_recommendations[mainArchetypeKey] || a_database.model_recommendations['default'];
                const funDriveColor = funDriveScore < 0 ? 'text-green-400' : 'text-yellow-400';
                const ovnColor = ovnPotential >= 7 ? 'text-green-400' : (ovnPotential >= 5 ? 'text-yellow-400' : 'text-red-400');

                return `
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="card p-6 rounded-lg lg:col-span-2">
                            <h3 class="text-lg font-semibold text-gray-400 mb-2 text-center">${translations[lang].disc_radar_title}</h3>
                            <div class="relative h-64 sm:h-80"><canvas id="discRadarChart"></canvas></div>
                        </div>
                        <div class="space-y-6">
                            <div class="card p-4 rounded-lg text-center">
                                <h3 class="text-base font-semibold text-gray-400 mb-1">${translations[lang].confidence_title}</h3>
                                <p class="text-3xl font-bold text-white">${confidence}%</p>
                            </div>
                            <div class="card p-4 rounded-lg text-center">
                                <h3 class="text-base font-semibold text-gray-400 mb-1">${translations[lang].fun_drive_title}</h3>
                                <p class="text-3xl font-bold ${funDriveColor}">${funDriveScore}</p>
                            </div>
                             <div class="card p-4 rounded-lg text-center">
                                <h3 class="text-base font-semibold text-gray-400 mb-1">${translations[lang].ovn_potential_title}</h3>
                                <p class="text-3xl font-bold ${ovnColor}">${ovnPotential * 10}%</p>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                         <div class="card p-6 rounded-lg text-center">
                            <h3 class="text-lg font-semibold text-gray-400 mb-2">${translations[lang].disc_title}</h3>
                            <p class="text-3xl font-bold text-red-500">${discProfile.name[lang]}</p>
                            <p class="text-sm text-gray-400 mt-2">${discProfile.description[lang]}</p>
                        </div>
                         <div class="card p-6 rounded-lg text-center">
                            <h3 class="text-lg font-semibold text-gray-400 mb-2">${translations[lang].archetype_title}</h3>
                            <p class="text-2xl font-bold text-white">${archetype.name[lang]}</p>
                            <p class="text-sm text-gray-400 mt-2">${archetype.description[lang]}</p>
                        </div>
                    </div>
                     <div class="card rounded-lg p-6 mt-6 text-center bg-gradient-to-r from-red-500/10 to-gray-800/10">
                         <h3 class="text-2xl font-bold text-white mb-2">${translations[lang].model_title}</h3>
                         <p class="text-5xl font-bold text-red-400 mb-3">${recommendation.model}</p>
                         <p class="text-gray-300 max-w-2xl mx-auto">${recommendation.justification[lang]}</p>
                     </div>
                `;
            }

            function buildCommunicationTab(result, lang) {
                const { mainDiscType } = result;
                const comms = communication_data[mainDiscType];
                if (!comms) return '';

                const keywordsHtml = comms.keywords[lang].map(kw => `<span class="bg-gray-700 text-gray-300 text-xs font-medium px-2.5 py-1 rounded-full">${kw}</span>`).join(' ');
                const phrasesHtml = comms.phrases.map(p => `<li class="italic">"${p[lang]}"</li>`).join('');
                const talkingPointsHtml = comms.talking_points.map(tp => `<li>${tp[lang]}</li>`).join('');

                return `
                    <div class="space-y-6">
                        <div>
                            <h4 class="font-semibold text-lg text-blue-400">${translations[lang].keywords_title}</h4>
                            <div class="flex flex-wrap gap-2 mt-2">${keywordsHtml}</div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-lg text-green-400">${translations[lang].phrases_title}</h4>
                            <ul class="list-disc list-inside text-gray-300 mt-2 space-y-2">${phrasesHtml}</ul>
                        </div>
                         <div>
                            <h4 class="font-semibold text-lg text-purple-400">${translations[lang].talking_points_title}</h4>
                            <ul class="list-disc list-inside text-gray-300 mt-2 space-y-2">${talkingPointsHtml}</ul>
                        </div>
                    </div>
                `;
            }

            function buildPlaybookTab(result, lang) {
                const { mainArchetypeKey, unlockedPlaybookItems } = result;
                const archetype = a_database.archetypes[mainArchetypeKey] || a_database.archetypes['cautious_adopter'];
                const strategy = archetype.strategy;
                if (!strategy) return `<p>${lang === 'pl' ? 'Brak strategii dla tego archetypu.' : 'No strategy for this archetype.'}</p>`;

                let recommendedTechniquesHtml = (strategy.recommended_techniques || []).map(techId => {
                    const tech = persuasion_data[techId];
                    if (!tech) return '';
                    return `<div class="bg-gray-800/50 p-3 rounded-lg">
                                <h5 class="font-semibold text-green-400">${tech.name[lang]}</h5>
                                <p class="text-sm text-gray-400">${tech.description[lang]}</p>
                            </div>`;
                }).join('');
                
                const argumentStackHtml = strategy.argument_stack ? `
                    <div>
                        <h4 class="font-semibold text-lg text-green-400">${lang === 'pl' ? 'Stos Argument√≥w' : 'Argument Stack'}</h4>
                        <div class="mt-2 p-4 bg-gray-800/50 rounded-lg space-y-3">
                            <p><strong class="text-green-300 w-20 inline-block">${lang === 'pl' ? 'Miƒôkki' : 'Soft'}:</strong> ${strategy.argument_stack.soft[lang]}</p>
                            <p><strong class="text-yellow-300 w-20 inline-block">${lang === 'pl' ? '≈öredni' : 'Medium'}:</strong> ${strategy.argument_stack.medium[lang]}</p>
                            <p><strong class="text-red-300 w-20 inline-block">${lang === 'pl' ? 'Mocny' : 'Strong'}:</strong> ${strategy.argument_stack.strong[lang]}</p>
                        </div>
                    </div>` : '';
                    
                const toolsHtml = strategy.roi_hook ? `
                    <div class="grid md:grid-cols-2 gap-6 mt-6">
                        <div>
                            <h4 class="font-semibold text-lg text-purple-400">${lang === 'pl' ? 'Hak ROI / TCO' : 'ROI / TCO Hook'}</h4>
                            <p class="mt-1 p-3 bg-gray-800/50 rounded-lg text-gray-300 font-bold">${strategy.roi_hook[lang]}</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-lg text-indigo-400">${lang === 'pl' ? 'Sugerowany Dow√≥d Spo≈Çeczny' : 'Suggested Social Proof'}</h4>
                            <p class="mt-1 p-3 bg-gray-800/50 rounded-lg text-gray-300">${strategy.social_proof[lang]}</p>
                        </div>
                    </div>` : '';
                    
                const nextQuestionHtml = strategy.next_question ? `
                    <div class="mt-6">
                        <h4 class="font-semibold text-lg text-teal-400">${lang === 'pl' ? 'Nastƒôpne Najlepsze Pytanie' : 'Next Best Question'}</h4>
                        <p class="mt-1 p-3 bg-gray-800/50 rounded-lg text-gray-300 italic">"${strategy.next_question[lang]}"</p>
                    </div>` : '';

                let unlockedContentHtml = '';
                if (unlockedPlaybookItems.length > 0) {
                    unlockedContentHtml += `<div class="mt-8 pt-6 border-t border-gray-700">
                                                <h4 class="font-semibold text-lg text-yellow-400">${translations[lang].unlocked_playbook_title}</h4>
                                                <div class="mt-2 space-y-3">`;
                    unlockedPlaybookItems.forEach(itemId => {
                        const item = unlocked_playbook_content[itemId];
                        if (item) {
                            unlockedContentHtml += `<div class="bg-yellow-900/20 p-3 rounded-lg border-l-4 border-yellow-500">
                                                        <h5 class="font-semibold text-yellow-300">${item.title[lang]}</h5>
                                                        <p class="text-sm text-gray-300">${item.content[lang]}</p>
                                                    </div>`;
                        }
                    });
                    unlockedContentHtml += `</div></div>`;
                }

                return `
                    <div class="space-y-6">
                        <div>
                            <h4 class="font-semibold text-lg text-blue-400">${lang === 'pl' ? 'Sugerowana Linia Otwarcia' : 'Suggested Opening Line'}</h4>
                            <p class="mt-1 p-3 bg-gray-800/50 rounded-lg text-gray-300 italic">"${strategy.opening_line[lang]}"</p>
                        </div>
                        ${argumentStackHtml}
                        ${toolsHtml}
                        ${nextQuestionHtml}
                        <div>
                            <h4 class="font-semibold text-lg text-green-400 mt-6">${lang === 'pl' ? 'Rekomendowane Techniki Perswazji' : 'Recommended Persuasion Techniques'}</h4>
                            <div class="mt-2 space-y-3">${recommendedTechniquesHtml}</div>
                        </div>
                        ${unlockedContentHtml}
                    </div>
                `;
            }

            function buildObjectionsTab(result, lang) {
                const { detectedObjectionIds } = result;
                if (detectedObjectionIds.length === 0) return `<p>${lang === 'pl' ? 'Nie wykryto ≈ºadnych konkretnych obiekcji.' : 'No specific objections detected.'}</p>`;

                let html = '<div class="space-y-8">';
                detectedObjectionIds.forEach(objId => {
                    const objection = objections_data[objId];
                    const trigger = a_database.triggers.find(t => t.objection_id === objId);
                    if (!objection || !trigger) return;

                    html += `<div class="card p-4 rounded-lg">
                                <h4 class="font-semibold text-lg text-red-400 mb-3">${trigger.text[lang]}</h4>
                                <div class="space-y-4">`;

                    objection.rebuttals.forEach(rebuttal => {
                        const technique = persuasion_data[rebuttal.technique];
                        html += `<div class="bg-gray-800/50 p-3 rounded-lg">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-bold text-yellow-400">${lang === 'pl' ? 'Poziom' : 'Level'} ${rebuttal.level}</span>
                                        <span class="text-sm font-semibold text-gray-300">${lang === 'pl' ? 'Technika' : 'Technique'}: ${technique.name[lang]}</span>
                                    </div>
                                    <p class="text-gray-300 italic">"${injectData(rebuttal.script[lang], lang)}"</p>
                                 </div>`;
                    });

                    html += `</div></div>`;
                });
                html += '</div>';
                return html;
            }

            function buildCompetitionTab(result, lang) {
                const { detectedCompetitorIds } = result;
                if (detectedCompetitorIds.length === 0) return `<p>${lang === 'pl' ? 'Klient nie odni√≥s≈Ç siƒô do konkurencji.' : 'Customer did not refer to competition.'}</p>`;

                let html = '<div class="space-y-6">';
                detectedCompetitorIds.forEach(compId => {
                    const competitor = market_data.competitor_analysis[compId];
                    if (!competitor) return;

                    html += `<div class="card p-4 rounded-lg">
                                <h4 class="font-semibold text-lg text-blue-400 mb-3">${lang === 'pl' ? 'Analiza Por√≥wnawcza' : 'Comparative Analysis'}: ${competitor.name}</h4>
                                <p class="text-sm text-gray-400 mb-3">${lang === 'pl' ? 'Cena bazowa' : 'Base Price'}: ${new Intl.NumberFormat(lang === 'pl' ? 'pl-PL' : 'en-US', { style: 'currency', currency: 'PLN', minimumFractionDigits: 0 }).format(competitor.base_price)}</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <h5 class="font-medium text-green-400 mb-2">${lang === 'pl' ? 'Kluczowe Zalety' : 'Key Advantages'}</h5>
                                        <ul class="list-disc list-inside text-gray-300 text-sm space-y-1">${competitor.key_advantages.map(adv => `<li>${adv}</li>`).join('')}</ul>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-red-400 mb-2">${lang === 'pl' ? 'Kluczowe Wady' : 'Key Disadvantages'}</h5>
                                        <ul class="list-disc list-inside text-gray-300 text-sm space-y-1">${competitor.key_disadvantages.map(dis => `<li>${dis}</li>`).join('')}</ul>
                                    </div>
                                </div>
                             </div>`;
                });
                html += '</div>';
                return html;
            }
            
            function buildTechniquesTab(result, lang) {
                 let html = `<div class="space-y-4">
                    <p class="text-gray-400">${lang === 'pl' ? 'PrzeglƒÖd wszystkich dostƒôpnych technik perswazji.' : 'Overview of all available persuasion techniques.'}</p>`;
                for(const techId in persuasion_data){
                    const tech = persuasion_data[techId];
                    html += `<div class="card p-4 rounded-lg">
                                <h4 class="font-semibold text-lg text-green-400">${tech.name[lang]}</h4>
                                <p class="text-gray-300 mt-1">${tech.description[lang]}</p>
                             </div>`;
                }
                html += '</div>';
                return html;
            }


            function showModal(message) {
                let modal = document.getElementById('feedbackModal');
                if (modal) modal.remove();
                
                modal = document.createElement('div');
                modal.id = 'feedbackModal';
                modal.className = 'fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50';
                modal.innerHTML = `<div class="bg-gray-800 rounded-lg shadow-xl p-6 max-w-sm w-full text-center border border-gray-700"><p class="text-white mb-6">${message}</p><button id="closeModalButton" class="btn-primary text-white font-bold py-2 px-8 rounded-lg">${translations[currentLanguage].modal_ok_button}</button></div>`;
                document.body.appendChild(modal);
                document.getElementById('closeModalButton').onclick = () => modal.remove();
                modal.onclick = (e) => { if (e.target.id === 'feedbackModal') modal.remove(); };
            }

            // --- Event Listeners ---
            analyzeButton.addEventListener('click', () => {
                const analysisResult = runAdvancedAnalysis();
                if (analysisResult) {
                    updateResultsUI(analysisResult);
                    document.getElementById('inputSection').classList.add('hidden');
                    analysisSection.classList.remove('hidden');
                    window.scrollTo(0, 0);
                }
            });

            resetButton.addEventListener('click', () => {
                analysisSection.classList.add('hidden');
                document.getElementById('inputSection').classList.remove('hidden');
                if(discChart) {
                    discChart.destroy();
                    discChart = null;
                }
                selectedDeepDive = {}; // Reset deep dive choices
                initializeUI();
            });

            langToggleButton.addEventListener('click', () => {
                const newLang = currentLanguage === 'pl' ? 'en' : 'pl';
                setLanguage(newLang);
            });
            
            // Initial setup
            setLanguage('pl');
        });
    </script>
</body>
</html>
